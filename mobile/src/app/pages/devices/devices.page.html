<ion-header class="ion-no-border">
    <ion-toolbar class="main-toolbar">
        <div class="header-content">
            <div class="welcome-section">
                <span>Welcome back,</span>
                <h1>Home Control</h1>
            </div>
            <ion-buttons slot="end">
                <ion-button (click)="logout()" class="profile-btn">
                    <div class="avatar-circle">RM</div>
                </ion-button>
            </ion-buttons>
        </div>
    </ion-toolbar>
    <ion-toolbar class="search-toolbar">
        <div class="search-container">
            <ion-searchbar placeholder="Find a device..." (ionInput)="onSearch($event)" [debounce]="300" mode="ios"
                class="premium-search">
            </ion-searchbar>
        </div>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
        <ion-refresher-content pullingIcon="chevron-down-circle-outline"
            refreshingSpinner="circles"></ion-refresher-content>
    </ion-refresher>

    <div class="content-wrapper">
        @if (isLoading) {
        <div class="loading-grid">
            @for (i of [1,2,3,4,5,6]; track i) {
            <div class="skeleton-card">
                <ion-skeleton-text animated style="height: 120px; border-radius: 20px;"></ion-skeleton-text>
            </div>
            }
        </div>
        } @else if (error) {
        <div class="state-container error">
            <div class="icon-blob danger">
                <ion-icon name="alert-circle-outline"></ion-icon>
            </div>
            <h2>Connectivity Issue</h2>
            <p>{{ error }}</p>
            <ion-button mode="ios" expand="block" (click)="loadDevices()" fill="outline">Reconnect</ion-button>
        </div>
        } @else if (filteredDevices.length === 0) {
        <div class="state-container empty">
            <div class="icon-blob medium">
                <ion-icon name="search-outline"></ion-icon>
            </div>
            @if (searchQuery) {
            <h2>No devices found</h2>
            <p>We couldn't find any results for "{{ searchQuery }}"</p>
            } @else {
            <h2>No devices yet</h2>
            <p>Your smart home dashboard is empty.</p>
            }
        </div>
        } @else {
        <div class="device-grid">
            @for (device of filteredDevices; track device.id) {
            <div class="device-card" [class.offline]="!device.isOnline" (click)="openDevice(device)">
                <div class="card-top">
                    <div class="device-type-icon" [attr.data-type]="device.type">
                        <span>{{ getDeviceIcon(device.type) }}</span>
                    </div>
                    <div class="status-indicator" [class.online]="device.isOnline"></div>
                </div>

                <div class="device-main">
                    <h3>{{ device.name }}</h3>
                    <p>{{ device.location }}</p>
                </div>

                <div class="card-bottom">
                    <div class="battery-info" [class]="getBatteryColor(device.batteryPercentage)">
                        <ion-icon [name]="getBatteryIcon(device.batteryPercentage)"></ion-icon>
                        <span>{{ device.batteryPercentage }}%</span>
                    </div>
                    <span class="time-ago">{{ getTimeAgo(device.lastUpdated) }}</span>
                </div>
            </div>
            }
        </div>
        <p class="stats-footer">{{ filteredDevices.length }} devices active</p>
        }
    </div>
</ion-content>