<ion-header class="ion-no-border">
    <ion-toolbar class="main-toolbar">
        <div class="header-content">
            <div class="welcome-section">
                <span>Alerts &</span>
                <h1>Notifications</h1>
            </div>
            <ion-buttons slot="end">
                <ion-button class="profile-btn">
                    <div class="avatar-circle">RM</div>
                </ion-button>
            </ion-buttons>
        </div>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
        <ion-refresher-content pullingIcon="chevron-down-circle-outline"
            refreshingSpinner="circles"></ion-refresher-content>
    </ion-refresher>

    <div class="content-wrapper">
        @if (isLoading) {
        <div class="loading-grid">
            <ion-skeleton-text animated style="height: 100px; border-radius: 20px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="height: 100px; border-radius: 20px;"></ion-skeleton-text>
        </div>
        } @else if (error) {
        <div class="state-container error">
            <div class="icon-blob danger">
                <ion-icon name="alert-circle-outline"></ion-icon>
            </div>
            <h2>Connectivity Issue</h2>
            <p>{{ error }}</p>
            <ion-button mode="ios" expand="block" (click)="loadAlerts()" fill="outline">Reconnect</ion-button>
        </div>
        } @else if (offlineDevices.length === 0 && lowBatteryDevices.length === 0) {
        <div class="state-container empty">
            <div class="icon-blob success">
                <ion-icon name="checkmark-circle-outline"></ion-icon>
            </div>
            <h2>Systems Optimal</h2>
            <p>All devices are functioning correctly.</p>
        </div>
        } @else {
        <div class="summary-section">
            <div class="summary-card danger">
                <div class="card-inner">
                    <span class="count">{{ offlineDevices.length }}</span>
                    <span class="label">Offline</span>
                </div>
            </div>
            <div class="summary-card warning">
                <div class="card-inner">
                    <span class="count">{{ lowBatteryDevices.length }}</span>
                    <span class="label">Low Power</span>
                </div>
            </div>
        </div>

        @if (offlineDevices.length > 0) {
        <div class="section-title">Critical Attention Required</div>
        <div class="alert-stack">
            @for (device of offlineDevices; track device.id) {
            <div class="alert-card critical" [routerLink]="['/devices', device.id]">
                <div class="card-lead">
                    <div class="icon-box">{{ getDeviceIcon(device.type) }}</div>
                </div>
                <div class="card-body">
                    <h3>{{ device.name }}</h3>
                    <p>Connection lost in {{ device.location }}</p>
                </div>
                <ion-icon name="chevron-forward-outline" class="go-icon"></ion-icon>
            </div>
            }
        </div>
        }

        @if (lowBatteryDevices.length > 0) {
        <div class="section-title">Maintenance Reminders</div>
        <div class="alert-stack">
            @for (device of lowBatteryDevices; track device.id) {
            <div class="alert-card warning" [routerLink]="['/devices', device.id]">
                <div class="card-lead">
                    <div class="icon-box">{{ getDeviceIcon(device.type) }}</div>
                </div>
                <div class="card-body">
                    <h3>{{ device.name }}</h3>
                    <p>Battery critical at {{ device.batteryPercentage }}%</p>
                </div>
                <div class="battery-tag">{{ device.batteryPercentage }}%</div>
            </div>
            }
        </div>
        }
        <div class="bottom-padding"></div>
        }
    </div>
</ion-content>